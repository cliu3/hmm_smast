<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of ge_contourf_old2</title>
  <meta name="keywords" content="ge_contourf_old2">
  <meta name="description" content="Reference page in help browser:">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../../index.html">Home</a> &gt;  <a href="#">hmm_smast</a> &gt; <a href="#">dependencies</a> &gt; <a href="#">googleearthtoolbox</a> &gt; <a href="index.html">matlab</a> &gt; ge_contourf_old2.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../../index.html"><img alt="<" border="0" src="../../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for hmm_smast/dependencies/googleearthtoolbox/matlab&nbsp;<img alt=">" border="0" src="../../../../right.png"></a></td></tr></table>-->

<h1>ge_contourf_old2
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>Reference page in help browser:</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="box"><strong>function varargout = ge_contourf(x,y,z,varargin) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Reference page in help browser:

 &lt;a href=&quot;matlab:web(fullfile(ge_root,'html','ge_contourf.html'),'-helpbrowser')&quot;&gt;link&lt;/a&gt; to html documentation
 &lt;a href=&quot;matlab:web(fullfile(ge_root,'html','license.html'),'-helpbrowser')&quot;&gt;show license statement&lt;/a&gt;</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="authoptions.html" class="code" title="function [AuthorizedOptions] = authoptions( filename )">authoptions</a>	% all available options to each function</li><li><a href="ge_poly.html" class="code" title="function output = ge_poly(X,Y,varargin)">ge_poly</a>	Reference page in help browser:</li><li><a href="parsepairs.html" class="code" title="">parsepairs</a>	% Please use the link below to view the documentation.</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../../matlabicon.gif)">
</ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function A = parsecontarray(C,nearInf)</a></li><li><a href="#_sub2" class="code">function IO = isclosed(myRecord,thresholdDiff)</a></li><li><a href="#_sub3" class="code">function IO = isinner(myRecord,otherRecord,lineValues)</a></li><li><a href="#_sub4" class="code">function innerBoundsStr=buildinnerstr(contourCell,isInnerArray,altitude)</a></li><li><a href="#_sub5" class="code">function S = conv2colorstr(B,G,R)</a></li><li><a href="#_sub6" class="code">function IO=hasouter(contourCell,myIndex)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function varargout = ge_contourf(x,y,z,varargin)</a>
0002 <span class="comment">% Reference page in help browser:</span>
0003 <span class="comment">%</span>
0004 <span class="comment">% &lt;a href=&quot;matlab:web(fullfile(ge_root,'html','ge_contourf.html'),'-helpbrowser')&quot;&gt;link&lt;/a&gt; to html documentation</span>
0005 <span class="comment">% &lt;a href=&quot;matlab:web(fullfile(ge_root,'html','license.html'),'-helpbrowser')&quot;&gt;show license statement&lt;/a&gt;</span>
0006 <span class="comment">%</span>
0007 
0008 
0009 AuthorizedOptions = <a href="authoptions.html" class="code" title="function [AuthorizedOptions] = authoptions( filename )">authoptions</a>( mfilename );
0010 
0011 
0012 id = <span class="string">'contourf'</span>;
0013 idTag = <span class="string">'id'</span>;
0014 name = <span class="string">'ge_contourf'</span>;
0015 timeStamp = <span class="string">' '</span>;
0016 timeSpanStart = <span class="string">' '</span>;
0017 timeSpanStop = <span class="string">' '</span>;
0018 description = <span class="string">''</span>;
0019 visibility = 1;
0020 lineColor = <span class="string">'00000000'</span>;
0021 lineColorPolyMax = <span class="string">'00000000'</span>;
0022 lineWidth = 0.25;
0023 snippet = <span class="string">' '</span>;
0024 extrude = 0;
0025 tessellate = 1;
0026 altitudeMode = <span class="string">'clampToGround'</span>;
0027 msgToScreen = false;
0028 region   = <span class="string">' '</span>;
0029 cMap = <span class="string">'jet'</span>;
0030 nearInf = abs(max(z(:))*10);
0031 <span class="comment">%       cLimHigh = max(max(z(2:end-1,2:end-1)));</span>
0032 <span class="comment">%        cLimLow = min(min(z(2:end-1,2:end-1)));</span>
0033 altitude = 1.0;
0034 polyAlpha = <span class="string">'C0'</span>;
0035 autoClose = true;
0036 tinyRes = 1e-4;
0037 lineValues = [];
0038 numClasses = [];
0039 numClassesDefault = 15;
0040 cLimHigh = max(z(:));
0041 cLimLow = min(z(:));
0042 
0043 <a href="parsepairs.html" class="code" title="">parsepairs</a> <span class="comment">%script that parses Parameter/value pairs.</span>
0044 
0045 minz = min(z(:));
0046 maxz = max(z(:));
0047 
0048 
0049 <span class="keyword">if</span> isempty(numClasses)&amp;~isempty(lineValues)
0050     <span class="keyword">if</span> cLimHigh&lt;maxz
0051         lineValues = unique([lineValues,maxz,nearInf]);
0052     <span class="keyword">else</span>
0053         lineValues = unique([lineValues,nearInf]);
0054     <span class="keyword">end</span>
0055 <span class="keyword">elseif</span> ~isempty(numClasses)&amp;isempty(lineValues)
0056     <span class="keyword">if</span> cLimHigh&lt;maxz
0057         TMP = linspace(cLimLow,cLimHigh,numClasses+1);
0058         lineValues = [TMP(1:end),maxz,nearInf];
0059     <span class="keyword">else</span>
0060         lineValues = [linspace(cLimLow,cLimHigh,numClasses+1),nearInf];
0061     <span class="keyword">end</span>
0062 <span class="keyword">elseif</span> isempty(numClasses)&amp;isempty(lineValues)
0063     <span class="comment">% do nothing</span>
0064     numClasses = 10;
0065     lineValues = [linspace(cLimLow,cLimHigh,numClasses+1),nearInf];
0066 <span class="keyword">else</span>
0067     error(<span class="string">'Cannot have both lineValues and numClasses'</span>)
0068 <span class="keyword">end</span>
0069 
0070 
0071 
0072 <span class="comment">% if cLimHigh&lt;maxz</span>
0073 <span class="comment">%     lineValues = [linspace(cLimLow,cLimHigh,numClasses+1),maxz,nearInf];</span>
0074 <span class="comment">% else</span>
0075 <span class="comment">%     lineValues = [linspace(cLimLow,cLimHigh,numClasses+1),nearInf];</span>
0076 <span class="comment">% end</span>
0077 
0078 
0079 [nR,nC] = size(z);
0080 tmp_z = ones([nR,nC]+2)*nearInf;
0081 tmp_z(2:end-1,2:end-1) = z;
0082 z = tmp_z;
0083 
0084 <span class="keyword">if</span> msgToScreen
0085     disp([<span class="string">'Running '</span> mfilename <span class="string">'...'</span>])
0086 <span class="keyword">end</span>
0087 
0088 <span class="keyword">if</span> lineWidth==0
0089     lineColor=<span class="string">'00000000'</span>;
0090 <span class="keyword">end</span>
0091 
0092 <span class="keyword">if</span>( isempty( x ) || isempty( y ) || isempty(z) )
0093     error(<span class="string">'empty coordinates passed to ge_contour().'</span>);
0094 <span class="keyword">end</span>
0095 
0096 
0097 <span class="keyword">if</span> ~(isequal(altitudeMode,<span class="string">'clampToGround'</span>)||<span class="keyword">...</span>
0098         isequal(altitudeMode,<span class="string">'relativeToGround'</span>)||<span class="keyword">...</span>
0099         isequal(altitudeMode,<span class="string">'absolute'</span>))
0100 
0101     error([<span class="string">'Variable '</span>,39,<span class="string">'altitudeMode'</span>,39, <span class="string">' should be one of '</span> ,39,<span class="string">'clampToGround'</span>,39,<span class="string">', '</span>,10,39,<span class="string">'relativeToGround'</span>,39,<span class="string">', or '</span>,39,<span class="string">'absolute'</span>,39,<span class="string">'.'</span> ])
0102 
0103 <span class="keyword">end</span>
0104 
0105 <span class="comment">% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %</span>
0106 <span class="comment">% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %</span>
0107 <span class="comment">% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %</span>
0108 
0109 
0110 <span class="keyword">if</span> ndims(x)==2 &amp;&amp; all(size(x)&gt;1)
0111     xv = x(1,:);
0112 <span class="keyword">else</span>
0113     xv = x;
0114 <span class="keyword">end</span>
0115 
0116 <span class="keyword">if</span> ndims(y)==2 &amp;&amp; all(size(y)&gt;1)
0117     yv = y(:,1);
0118 <span class="keyword">else</span>
0119     yv = y;
0120 <span class="keyword">end</span>
0121 
0122 dx = ((xv(end)-xv(1))/(numel(xv)-1))*tinyRes;
0123 xv = [xv(1)-dx,xv,xv(end)+dx];
0124 dy = ((yv(end)-yv(1))/(numel(yv)-1))*tinyRes;
0125 yv = [yv(1)-dy;yv;yv(end)+dy];
0126 
0127 contourArray = contourc(xv,yv,z,lineValues);
0128 
0129 
0130 <span class="comment">%save contourcresult.mat contourArray</span>
0131 
0132 <span class="keyword">if</span> ischar(cMap)
0133 
0134     figHandles = get(0,<span class="string">'children'</span>);
0135 
0136     <span class="keyword">while</span> true
0137         RIx = round(rand*1e9);
0138         <span class="keyword">if</span> ~ismember(RIx,figHandles)
0139             figure(RIx)
0140             eval([<span class="string">'C1 = colormap('</span> cMap <span class="string">'(256));'</span>]);
0141             <span class="keyword">break</span>
0142         <span class="keyword">end</span>
0143     <span class="keyword">end</span>
0144     close(RIx)
0145     clear RIx
0146 
0147 <span class="keyword">else</span>
0148     C1 = cMap;
0149 <span class="keyword">end</span>
0150 
0151 X = linspace(0,1,size(C1,1))';
0152 YRed = C1(:,1);
0153 YGreen = C1(:,2);
0154 YBlue = C1(:,3);
0155 
0156 
0157 
0158 polyClosedThreshold = 1e-5; <span class="comment">% Declare polygons closed when their start...</span>
0159 <span class="comment">% and end points are separated by a distance...</span>
0160 <span class="comment">% less than this value.</span>
0161 
0162 contourCell = <a href="#_sub1" class="code" title="subfunction A = parsecontarray(C,nearInf)">parsecontarray</a>(contourArray,nearInf);
0163 <span class="comment">% lineValuesMinMax = min(z(:));</span>
0164 <span class="comment">%</span>
0165 <span class="comment">% for k=1:size(contourCell,1)</span>
0166 <span class="comment">%     lineValuesMinMax = [lineValuesMinMax;contourCell{k,1}];</span>
0167 <span class="comment">% end</span>
0168 <span class="comment">% lineValuesMinMax = unique([lineValuesMinMax(:);max(z(:))]);</span>
0169 
0170 
0171 
0172 <span class="comment">% colorLevelInc = 0;</span>
0173 nRecords = size(contourCell,1);
0174 isInnerArray=repmat(NaN,[nRecords,1]);
0175 <span class="comment">% aa=[]</span>
0176 kmlStr = <span class="string">''</span>;
0177 <span class="keyword">for</span> m = 1:nRecords <span class="comment">% my</span>
0178 
0179     isInnerArray(:) = NaN;
0180 
0181     <span class="keyword">for</span> o = [1:m-1,m+1:nRecords]
0182 
0183         <span class="comment">% isinner(myRecord,otherRecord)</span>
0184         isInnerArray(o,1)=<a href="#_sub3" class="code" title="subfunction IO = isinner(myRecord,otherRecord,lineValues)">isinner</a>(contourCell(m,1:4),contourCell(o,1:4),lineValues);
0185 
0186     <span class="keyword">end</span>
0187 
0188     <span class="keyword">if</span> <a href="#_sub2" class="code" title="subfunction IO = isclosed(myRecord,thresholdDiff)">isclosed</a>(contourCell(m,:),polyClosedThreshold)
0189 
0190         <span class="keyword">if</span> <a href="#_sub6" class="code" title="subfunction IO=hasouter(contourCell,myIndex)">hasouter</a>(contourCell,m)
0191             colorLevelInc = 0;
0192         <span class="keyword">else</span>
0193             colorLevelInc = 0;
0194         <span class="keyword">end</span>
0195 
0196         levelDiff = abs(contourCell{m,1}-lineValues);
0197         colorLevel = find(levelDiff==min(levelDiff));
0198         colorDist = (cLimHigh-cLimLow);        
0199         <span class="keyword">if</span> colorLevel==1|colorLevel==numel(lineValues)-1
0200             f = (mean(lineValues(colorLevel+colorLevelInc+[0]))-cLimLow)/colorDist;
0201 <span class="comment">%         elseif colorLevel==numel(lineValues)-1</span>
0202 <span class="comment">%             f = (mean(lineValues(colorLevel+colorLevelInc+[1]))-cLimLow)/colorDist</span>
0203         <span class="keyword">else</span>
0204             f = (mean(lineValues(colorLevel+colorLevelInc+[0,1]))-cLimLow)/colorDist;
0205         <span class="keyword">end</span> <span class="comment">%colorLevel==1</span>
0206 
0207         <span class="keyword">if</span> f&lt;0
0208             f=0;
0209         <span class="keyword">end</span>
0210         <span class="keyword">if</span> f&gt;1
0211             f=1;
0212         <span class="keyword">end</span>
0213 
0214         YIRed = interp1(X,YRed,f);
0215         YIGreen = interp1(X,YGreen,f);
0216         YIBlue = interp1(X,YBlue,f);
0217         polyColor = [polyAlpha,<a href="#_sub5" class="code" title="subfunction S = conv2colorstr(B,G,R)">conv2colorstr</a>(YIRed,YIGreen,YIBlue)];
0218         <span class="comment">%             polyColorCell{colorLevel+colorLevelInc,1} = polyColor;</span>
0219         innerBoundsStr = <a href="#_sub4" class="code" title="subfunction innerBoundsStr=buildinnerstr(contourCell,isInnerArray,altitude)">buildinnerstr</a>(contourCell,isInnerArray,altitude);
0220 
0221         <span class="keyword">if</span> colorLevel+colorLevelInc==1
0222             colorClassStr = sprintf(<span class="string">'less than %f'</span>,lineValues(colorLevel));
0223             actualLineColor = lineColor;
0224 <span class="comment">%         elseif colorLevel+colorLevelInc&gt;=numel(lineValues)-2</span>
0225 <span class="comment">%             colorClassStr = sprintf('more than %f',lineValues(colorLevel-1));</span>
0226 <span class="comment">%             actualLineColor = lineColorPolyMax;</span>
0227 <span class="comment">%             %actualLineColor = lineColor;</span>
0228          <span class="keyword">else</span>
0229             colorClassStr = sprintf(<span class="string">'%f-%f'</span>,lineValues(colorLevel+colorLevelInc-1),lineValues(colorLevel+colorLevelInc));
0230             actualLineColor = lineColor;
0231          <span class="keyword">end</span>
0232 
0233         kmlStr=[kmlStr,<a href="ge_poly.html" class="code" title="function output = ge_poly(X,Y,varargin)">ge_poly</a>(contourCell{m,3},contourCell{m,4},<span class="keyword">...</span>
0234             <span class="string">'altitude'</span>,altitude,<span class="keyword">...</span>
0235             <span class="string">'innerBoundsStr'</span>,innerBoundsStr,<span class="keyword">...</span>
0236             <span class="string">'lineColor'</span>,actualLineColor,<span class="keyword">...</span>
0237             <span class="string">'lineWidth'</span>,lineWidth,<span class="keyword">...</span>
0238             <span class="string">'polyColor'</span>,polyColor,<span class="keyword">...</span>
0239             <span class="string">'autoClose'</span>,autoClose,<span class="keyword">...</span>
0240             <span class="string">'region'</span>, region, <span class="keyword">...</span>
0241             <span class="string">'timeSpanStart'</span>,timeSpanStart,<span class="keyword">...</span>
0242             <span class="string">'timeSpanStop'</span>,timeSpanStop,<span class="keyword">...</span>
0243             <span class="string">'altitudeMode'</span>,altitudeMode,<span class="keyword">...</span>
0244             <span class="string">'tessellate'</span>,tessellate,<span class="keyword">...</span>
0245             <span class="string">'extrude'</span>,extrude,<span class="keyword">...</span>
0246             <span class="string">'visibility'</span>,visibility,<span class="keyword">...</span>
0247             <span class="string">'name'</span>,colorClassStr)];
0248     <span class="keyword">else</span>
0249         warning([<span class="string">'Contour line record in '</span>,39,<span class="string">'contourCell{'</span>,<span class="keyword">...</span>
0250             num2str(m),<span class="string">',1}'</span>,39,<span class="string">' skipped'</span>,10,<span class="keyword">...</span>
0251             <span class="string">'because it is not closed.'</span>])
0252     <span class="keyword">end</span>
0253     <span class="comment">%     end</span>
0254 <span class="keyword">end</span>
0255 
0256 <span class="comment">% save contourcell.mat contourCell</span>
0257 <span class="comment">% figure</span>
0258 <span class="comment">% for k=1:size(contourCell,1)</span>
0259 <span class="comment">%     plot(contourCell{k,3},contourCell{k,4},'-k.')</span>
0260 <span class="comment">%     hold on</span>
0261 <span class="comment">% end</span>
0262 <span class="comment">%</span>
0263 
0264 <span class="keyword">if</span> nargout==1
0265     varargout{1} = kmlStr;
0266 <span class="keyword">elseif</span> nargout==2
0267     varargout{1} = kmlStr;
0268     varargout{2} = polyColorCell;
0269 <span class="keyword">else</span>
0270 <span class="keyword">end</span>
0271 
0272 <span class="comment">% aa</span>
0273 
0274 
0275 <span class="comment">% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %</span>
0276 <span class="comment">% % % % % % % %      LOCAL FUNCTIONS START HERE       % % % % % % % % % %</span>
0277 <span class="comment">% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %</span>
0278 
0279 
0280 
0281 <a name="_sub1" href="#_subfunctions" class="code">function A = parsecontarray(C,nearInf)</a>
0282 
0283 <span class="comment">% column 1: level</span>
0284 <span class="comment">% column 2: number of points</span>
0285 <span class="comment">% column 3: xcoords</span>
0286 <span class="comment">% column 4: ycoords</span>
0287 
0288 curCol = 1;
0289 n = 1;
0290 
0291 <span class="keyword">while</span> curCol&lt;size(C,2)
0292 
0293     L = C(2,curCol);
0294     lineValue = C(1,curCol);
0295     <span class="keyword">if</span> lineValue~=nearInf
0296         A{n,1} = C(1,curCol);
0297         A{n,2} = L;
0298         A{n,3} = C(1,curCol+1:curCol+L);
0299         A{n,4} = C(2,curCol+1:curCol+L);
0300         <span class="comment">%lineValuesTmp(n,1) = C(1,curCol);</span>
0301         n = n + 1;
0302     <span class="keyword">end</span>
0303 
0304     curCol = curCol + L + 1;
0305 
0306 <span class="keyword">end</span>
0307 
0308 <span class="comment">%lineValues = unique(lineValuesTmp);</span>
0309 
0310 
0311 <span class="comment">% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %</span>
0312 <span class="comment">% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %</span>
0313 <span class="comment">% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %</span>
0314 <a name="_sub2" href="#_subfunctions" class="code">function IO = isclosed(myRecord,thresholdDiff)</a>
0315 
0316 L = myRecord{1,2};
0317 xDiff = [myRecord{1,3}(1),myRecord{1,4}(1)];
0318 yDiff = [myRecord{1,3}(L),myRecord{1,4}(L)];
0319 
0320 IO = all(abs(xDiff-yDiff)&lt;thresholdDiff);
0321 
0322 <a name="_sub3" href="#_subfunctions" class="code">function IO = isinner(myRecord,otherRecord,lineValues)</a>
0323 
0324 <span class="comment">% It seems that contourc sometimes rounds off in a weird way...therefore</span>
0325 <span class="comment">% a tweak is necessary here, in order not to end up with empty 'myIndexVec'</span>
0326 <span class="comment">% and 'otherIndexVec' variables.</span>
0327 <span class="comment">% check whether adjacent levels are concerned:</span>
0328 <span class="comment">% myIndexVec = find(lineValues==myRecord{1,1});</span>
0329 <span class="comment">% otherIndexVec = find(lineValues==otherRecord{1,1});</span>
0330 TMP = unique(lineValues);
0331 dTMP = TMP(2:end)-TMP(1:end-1);
0332 smallestDist = min(unique(dTMP));
0333 roundOffFactor = 100;
0334 
0335 myRecordRound = round(myRecord{1,1}/(smallestDist/roundOffFactor))*<span class="keyword">...</span>
0336     (smallestDist/roundOffFactor);
0337 otherRecordRound = round(otherRecord{1,1}/(smallestDist/roundOffFactor))*<span class="keyword">...</span>
0338     (smallestDist/roundOffFactor);
0339 
0340 lineValuesRound = round(lineValues/(smallestDist/roundOffFactor))*<span class="keyword">...</span>
0341     (smallestDist/roundOffFactor);
0342 
0343 myIndexVec = find(lineValuesRound==myRecordRound);
0344 otherIndexVec = find(lineValuesRound==otherRecordRound);
0345 
0346 
0347 <span class="comment">% firstTest = any(abs(myIndexVec-otherIndexVec)==[1,0]);</span>
0348 firstTest = ismember(myIndexVec-otherIndexVec,[-1,0,1]);
0349 
0350 <span class="comment">% check whether the points of otherRecord fall within those of myRecord.</span>
0351 
0352 <span class="keyword">if</span> ~firstTest
0353     IO = false;
0354 <span class="keyword">else</span>
0355     IN = inpolygon(otherRecord{1,3},otherRecord{1,4},<span class="keyword">...</span>
0356         myRecord{1,3},myRecord{1,4});
0357     secondTest = all(IN);
0358 <span class="keyword">end</span>
0359 
0360 IO = firstTest &amp;&amp; secondTest;
0361 
0362 
0363 <span class="comment">% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %</span>
0364 <span class="comment">% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %</span>
0365 <span class="comment">% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %</span>
0366 
0367 
0368 <a name="_sub4" href="#_subfunctions" class="code">function innerBoundsStr=buildinnerstr(contourCell,isInnerArray,altitude)</a>
0369 innerBoundsStr=<span class="string">''</span>;
0370 oIndex = find(isInnerArray==1)';
0371 
0372 <span class="comment">% clf</span>
0373 <span class="comment">% for u=oIndex</span>
0374 <span class="comment">%     plot(contourCell{u,3},contourCell{u,4},'-b')</span>
0375 <span class="comment">%     hold on</span>
0376 <span class="comment">%     axis image</span>
0377 <span class="comment">% end</span>
0378 
0379 <span class="comment">% initialize 'contained' array:</span>
0380 contained=~(triu(ones(numel(oIndex))).*tril(ones(numel(oIndex))));
0381 <span class="keyword">if</span> isempty(oIndex)
0382     iVec = [];
0383 <span class="keyword">elseif</span> numel(oIndex)==1
0384     iVec = oIndex(1);
0385 <span class="keyword">else</span>
0386     <span class="keyword">for</span> i = 1:numel(oIndex)
0387         <span class="keyword">for</span> j = [1:i-1,i+1:numel(oIndex)]
0388 
0389             u = oIndex(i);
0390             v = oIndex(j);
0391             <span class="keyword">if</span> all(inpolygon(contourCell{u,3},contourCell{u,4},<span class="keyword">...</span>
0392                     contourCell{v,3},contourCell{v,4}))
0393                 contained(i,j) = 0;
0394             <span class="keyword">end</span>
0395         <span class="keyword">end</span>
0396     <span class="keyword">end</span>
0397     iVec = oIndex(sum(contained,2)==numel(oIndex)-1);
0398 <span class="keyword">end</span>
0399 
0400 <span class="keyword">for</span> elem = iVec
0401     innerBoundsStr = [innerBoundsStr,<span class="keyword">...</span>
0402         <span class="string">'&lt;innerBoundaryIs&gt;'</span>,char(10),<span class="keyword">...</span>
0403         <span class="string">'   &lt;LinearRing&gt;'</span>,char(10),<span class="keyword">...</span>
0404         <span class="string">'      &lt;coordinates&gt;'</span>,char(10),<span class="keyword">...</span>
0405         sprintf(<span class="string">'          %.16g,%.16g,%.16g \n'</span>,[contourCell{elem,3}',contourCell{elem,4}',<span class="keyword">...</span>
0406         altitude*ones(size(contourCell{elem,4}'))]'),char(10),<span class="keyword">...</span>
0407         <span class="string">'      &lt;/coordinates&gt;'</span>,char(10),<span class="keyword">...</span>
0408         <span class="string">'   &lt;/LinearRing&gt;'</span>,char(10),<span class="keyword">...</span>
0409         <span class="string">'&lt;/innerBoundaryIs&gt;'</span>,char(10)];
0410 <span class="keyword">end</span>
0411 
0412 <span class="comment">% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %</span>
0413 <span class="comment">% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %</span>
0414 <span class="comment">% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %</span>
0415 
0416 
0417 <a name="_sub5" href="#_subfunctions" class="code">function S = conv2colorstr(B,G,R)</a>
0418 <span class="comment">% Please note that this conv2colorstr is different from that in</span>
0419 <span class="comment">% ge_colorbar. This one writes KML formatted hexadecimal</span>
0420 <span class="comment">% colorstrings, ge_colorbar() writes HTML formatted colorstr.</span>
0421 
0422 
0423 S=<span class="string">'000000'</span>;
0424 
0425 hexB = dec2hex(round(B*255));
0426 hexG = dec2hex(round(G*255));
0427 hexR = dec2hex(round(R*255));
0428 
0429 LB = length(hexB);
0430 LG = length(hexG);
0431 LR = length(hexR);
0432 
0433 S(3-LB:2)=hexB;
0434 S(5-LG:4)=hexG;
0435 S(7-LR:6)=hexR;
0436 
0437 
0438 <a name="_sub6" href="#_subfunctions" class="code">function IO=hasouter(contourCell,myIndex)</a>
0439 
0440 nRecords = size(contourCell,1);
0441 
0442 inVec=repmat(NaN,[nRecords,1]);
0443 uVec=[1:myIndex-1,myIndex+1:nRecords];
0444 <span class="keyword">for</span> u=uVec
0445     <span class="keyword">if</span> contourCell{u,1}==contourCell{myIndex,1}
0446         inVec(u) = all(inpolygon(contourCell{myIndex,3},contourCell{myIndex,4},<span class="keyword">...</span>
0447             contourCell{u,3},contourCell{u,4}));
0448     <span class="keyword">else</span>
0449         inVec(u) = false;
0450     <span class="keyword">end</span>
0451 <span class="keyword">end</span>
0452 
0453 IO=any(inVec(uVec));
0454 
0455 
0456 
0457 
0458</pre></div>
<hr><address>Generated on Thu 15-Sep-2016 12:42:46 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>