% write the most probably track to a google earth file
function write_ge_track(mpt); 

%WRITE_GE_TRACK : dump a track (lon,lat,time) to a google earth file 
%   HANDLE = WRITE_GE_TRACK(TRACK) 
%
%   - TRACK a struct containing an output from eg. samptrack.
%
%     Optional arguments
%
%  EXAMPLE   
%   WRITE_GE_TRACK(mpt) 
%
%   Date: 3/16/12 
%   G. Cowles


% transfer data
time = mpt.time;
drels = time(1);
drcap = time(end);
lon = mpt.long; 
lat = mpt.lat; 
kmlFileName = [mpt.tagno '.kml'];

rls_iconStr = 'http://maps.google.com/mapfiles/kml/pal3/icon38.png';
rcp_iconStr = 'http://maps.google.com/mapfiles/kml/pal5/icon13.png';
dot_iconStr = 'http://maps.google.com/mapfiles/kml/pal4/icon49.png';

kmlstr = '';
dstr = datestr( time(1), 'yyyy-mm-ddTHH:MM:SSZ');
dstr2 = datestr( time(end), 'yyyy-mm-ddTHH:MM:SSZ');
% dump release/recap/icons
kmlstr  = ''
kmlstr = [kmlstr,ge_point(lon(1),lat(1),0., ...
                     'iconURL',rls_iconStr,...
                     'msgToScreen',true,...
                     'pointDataCell',{'Lon',num2str(lon(1),'%5.2f');... 
                                      'Lat',num2str(lat(1),'%5.2f');...
                                      'Release Date',datestr(drels);,...
                                      'Recap Date'  ,datestr(drcap);,...
                                      'Days at Liberty',int2str(ceil(drcap-drels))},...
                     'timeSpanStart', char(dstr), ...
                     'timeSpanStop',  char(dstr2 ), ...
                     'name',[mpt.tagno])];

kmlstr = [kmlstr,ge_point(lon(end),lat(end),0., ...
                     'iconURL',rcp_iconStr,...
                     'msgToScreen',true,...
                     'pointDataCell',{'Lon',num2str(lon(end),'%5.2f');... 
                                      'Lat',num2str(lat(end),'%5.2f');...
                                      'Release Date',datestr(drels);,...
                                      'Recap Date'  ,datestr(drcap);,...
                                      'Days at Liberty',int2str(ceil(drcap-drels))},...
                     'timeSpanStart', char(dstr), ...
                     'timeSpanStop',  char(dstr2 ), ...
                     'name',[mpt.tagno])];

kmlstr  =  [kmlstr, ge_plot(lon,lat,...
                     'altitude',100,...
                     'forceAsLine',false,...
                     'tessellate',true,...
                     'lineWidth',2,...
                     'timeSpanStart', char(dstr), ...
                     'timeSpanStop',  char(dstr2 ), ...
                     'altitudeMode','clampToGround')]; 

for i=1:numel(time)-1
  dstr = datestr( time(i), 'yyyy-mm-ddTHH:MM:SSZ')
  dstr2 = datestr( time(i+1), 'yyyy-mm-ddTHH:MM:SSZ')
  kmlstr = [kmlstr,ge_point(lon(i),lat(i),0., ...
                       'iconURL',dot_iconStr,...
                       'msgToScreen',true,...
                       'timeSpanStart', char(dstr), ...
                       'timeSpanStop', char(dstr2))]; 
end;



kmlTargetDir = [''];%..',filesep,'kml',filesep];
ge_output([kmlTargetDir,kmlFileName],[kmlstr],'name',kmlFileName);

%endf = ge_folder('endpoints', endstr);
%trackf = ge_folder('track', kmlstr);
%ge_output(kmlFileName,[endf]);

